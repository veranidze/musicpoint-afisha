<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Point - Афиша</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #e5e7eb; overflow-x: hidden; }
        body.modal-open { overflow: hidden; }
        .animated-gradient { background: linear-gradient(-45deg, #111827, #1f2937, #374151, #4b5563); background-size: 400% 400%; animation: gradient 15s ease infinite; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-effect { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .loader { border: 4px solid #4b5563; border-top: 4px solid #a5b4fc; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { display: none; }
        .modal-overlay.active { display: flex; }
    </style>
</head>
<body>
    <div class="animated-gradient"></div>
    <div class="relative z-10 container mx-auto px-4">
        <header class="text-center py-16 px-4 flex flex-col items-center">
            <img src="https://placehold.co/128x128/ffffff/9333ea?text=MP" alt="Music Point Logo" class="w-32 h-32 mb-6 rounded-full shadow-lg border-4 border-white/20 bg-white/10 object-contain" />
            <h1 class="text-3xl font-bold text-white mb-2">Концертный зал «Магнолия»</h1>
            <p class="text-lg text-indigo-300 mb-2">ул. Шерифа Химшиашвили 4</p>
        </header>
        <main>
            <div id="event-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <div class="col-span-full flex justify-center py-10"><div class="loader"></div></div>
            </div>
        </main>
        <footer class="text-center py-10 mt-16 border-t border-gray-700">
            <p class="text-gray-400">&copy; 2025 Music Point. Все права защищены.</p>
        </footer>
    </div>
    
    <div id="modal-overlay" class="modal-overlay fixed inset-0 bg-black bg-opacity-75 items-center justify-center z-50 p-4">
        <div id="modal-content" class="glass-effect w-full max-w-4xl max-h-[90vh] rounded-2xl overflow-y-auto">
            <div class="relative h-96 w-full flex-shrink-0">
                <img id="modal-image" class="w-full h-full object-cover" src="" alt="" />
                <button id="modal-close-button" class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center text-2xl hover:bg-opacity-75 z-20">&times;</button>
            </div>
            <div class="p-8">
                <h2 id="modal-title" class="text-4xl font-bold text-white mb-4"></h2>
                <p id="modal-description" class="text-gray-300 mb-8"></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_BASE_URL = 'http://16.170.141.43:3000';
            const eventListContainer = document.getElementById('event-list');
            const modalOverlay = document.getElementById('modal-overlay');
            const modalCloseButton = document.getElementById('modal-close-button');
            const modalContent = document.getElementById('modal-content');

            async function fetchAndRenderEvents() {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/events`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const events = await response.json();
                    renderEvents(events);
                } catch (error) {
                    console.error('Failed to fetch events:', error);
                    eventListContainer.innerHTML = `<div class="col-span-full text-center text-red-400">Не удалось загрузить события.</div>`;
                }
            }
            
            function renderEvents(events) {
                eventListContainer.innerHTML = '';
                if (!events.length) {
                    eventListContainer.innerHTML = `<div class="col-span-full text-center text-gray-400">Событий не найдено.</div>`;
                    return;
                }

                events.forEach(event => {
                    const card = document.createElement('div');
                    card.className = 'glass-effect rounded-xl overflow-hidden shadow-lg transform hover:-translate-y-2 transition-transform duration-300 ease-in-out group flex flex-col';
                    const imageUrl = event.gallery && event.gallery.length > 0 ? `${API_BASE_URL}${event.gallery[0]}` : 'https://placehold.co/600x400/9333ea/ffffff?text=Event';
                    
                    card.innerHTML = `
                        <div class="relative">
                            <img class="w-full h-56 object-cover" src="${imageUrl}" alt="Афиша для ${event.title}" />
                            <div class="absolute top-0 right-0 bg-black bg-opacity-50 text-white text-sm font-bold px-3 py-1 m-2 rounded-full">${event.genre}</div>
                        </div>
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-2xl font-bold text-white mb-2">${event.title}</h3>
                            <div class="flex items-center text-indigo-300 mb-2">
                                <i class="far fa-calendar-alt mr-2"></i>
                                <p>${new Date(event.date).toLocaleDateString('ru-RU')} / ${event.time}</p>
                            </div>
                            <p class="text-gray-400 text-sm mb-4 flex-grow">${event.fullDescription.substring(0, 110)}...</p>
                            <button class="details-button w-full mt-auto bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700">Подробнее</button>
                        </div>
                    `;
                    card.querySelector('.details-button').addEventListener('click', () => openModal(event));
                    eventListContainer.appendChild(card);
                });
            }

            function openModal(event) {
                const imageUrl = event.gallery && event.gallery.length > 0 ? `${API_BASE_URL}${event.gallery[0]}` : '';
                document.getElementById('modal-image').src = imageUrl;
                document.getElementById('modal-title').textContent = event.title;
                document.getElementById('modal-description').textContent = event.fullDescription;
                modalOverlay.style.display = 'flex';
                document.body.classList.add('modal-open');
            }

            function closeModal() {
                modalOverlay.style.display = 'none';
                document.body.classList.remove('modal-open');
            }

            modalCloseButton.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) closeModal();
            });

            fetchAndRenderEvents();
        });
    </script>
</body>
</html>
